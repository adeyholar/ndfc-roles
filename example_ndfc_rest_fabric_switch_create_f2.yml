# example_ndfc_rest_fabric_switch_create_f2.yml
# This creates a standalone fabric (i.e. not MSD child).  As such, it provisions only the leaf and spine layers (does not provision border-gateways)
---
# Fabric and devices
- hosts: ndfc
  gather_facts: false
  roles:
    - ndfc_rest_fabric_switch_create
  vars:
    fabric_name: f2

# leaf_5
- hosts: ndfc
  gather_facts: false
  roles:
    - ndfc_device_merged
  vars:
    device_name: leaf_5

# leaf_6
- hosts: ndfc
  gather_facts: false
  roles:
    - ndfc_device_merged
  vars:
    device_name: leaf_6

# leaf_7
- hosts: ndfc
  gather_facts: false
  roles:
    - ndfc_device_merged
  vars:
    device_name: leaf_7

# leaf_8
- hosts: ndfc
  gather_facts: false
  roles:
    - ndfc_device_merged
  vars:
    device_name: leaf_8

# spine_3
- hosts: ndfc
  gather_facts: false
  roles:
    - ndfc_device_merged
  vars:
    device_name: spine_3

# spine_4
- hosts: ndfc
  gather_facts: false
  roles:
    - ndfc_device_merged
  vars:
    device_name: spine_4

# vpc_3
- hosts: ndfc
  gather_facts: false
  roles:
  - ndfc_rest_vpc_create
  vars:
    vpc_name: vpc_3

- hosts: ndfc
  gather_facts: false
  roles:
  - ndfc_vpc_interface_merged_all
  vars:
    vpc_name: vpc_3

# vpc_4
- hosts: ndfc
  gather_facts: false
  roles:
  - ndfc_rest_vpc_create
  vars:
    vpc_name: vpc_4

- hosts: ndfc
  gather_facts: false
  roles:
  - ndfc_vpc_interface_merged_all
  vars:
    vpc_name: vpc_4

# VRFs
- hosts: ndfc
  gather_facts: false
  roles:
  - ndfc_vrf_all
  vars:
    fabric_name: f2
    state: replaced

# Networks
- hosts: ndfc
  gather_facts: false
  roles:
  - ndfc_network_replaced_all
  vars:
    fabric_name: f2

# Deploy
- hosts: ndfc
  gather_facts: false
  roles:
    - ndfc_rest_config_deploy_all
  vars:
    fabric_name: f2

- hosts: ndfc
  name: fabric f2 vrf {{ vrf_name }} import vrf {{ import_vrf_name }} route-targets
  gather_facts: false
  vars:
    state: merged
    vrf_name: v1
    import_vrf_name: v2
    devices:
      - leaf_5
      - leaf_6
      - leaf_7
      - leaf_8
  roles:
    - ndfc_policy_vrf_rt_import_evpn_loop

# Deploy
- hosts: ndfc
  gather_facts: false
  roles:
    - ndfc_rest_config_deploy_all
  vars:
    fabric_name: f2

- hosts: ndfc
  name: fabric f2 vrf {{ vrf_name }} import vrf {{ import_vrf_name }} route-targets
  gather_facts: false
  vars:
    state: merged
    vrf_name: v2
    import_vrf_name: v1
    devices:
      - leaf_5
      - leaf_6
      - leaf_7
      - leaf_8
  roles:
    - ndfc_policy_vrf_rt_import_evpn_loop

# Deploy
- hosts: ndfc
  gather_facts: false
  roles:
    - ndfc_rest_config_deploy_all
  vars:
    fabric_name: f2
